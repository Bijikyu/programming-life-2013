From ac7c8952bcbfaa25da960abf7f164c4b3ae8352d Mon Sep 17 00:00:00 2001
From: Steffan Sluis <steffansluis@gmail.com>
Date: Thu, 23 May 2013 09:41:08 +0200
Subject: [PATCH 1/2] Undo updates on cell load

---
 app/assets/javascripts/views/raphael.cell.js.coffee |  2 ++
 app/assets/javascripts/views/raphael.main.js.coffee | 10 ++++++++++
 2 files changed, 12 insertions(+)

diff --git a/app/assets/javascripts/views/raphael.cell.js.coffee b/app/assets/javascripts/views/raphael.cell.js.coffee
index 475edfb..1ffcffc 100644
--- a/app/assets/javascripts/views/raphael.cell.js.coffee
+++ b/app/assets/javascripts/views/raphael.cell.js.coffee
@@ -51,6 +51,8 @@ class View.Cell extends View.RaphaelBase
 				@_bind( 'cell.add.metabolite', @, @onModuleAdd )
 				@_bind( 'cell.remove.module', @, @onModuleRemove )
 				@_bind( 'cell.remove.metabolite', @, @onModuleRemove )
+
+				@_trigger( 'view.cell.set', @, [ @cell ] )
 				
 				@redraw() if @_x? and @_y? and @_scale?
 
diff --git a/app/assets/javascripts/views/raphael.main.js.coffee b/app/assets/javascripts/views/raphael.main.js.coffee
index 78c5074..4048bb5 100644
--- a/app/assets/javascripts/views/raphael.main.js.coffee
+++ b/app/assets/javascripts/views/raphael.main.js.coffee
@@ -24,6 +24,8 @@ class View.Main extends View.RaphaelBase
 		@resize()
 		$( window ).on( 'resize', @resize )
 
+		@_bind( 'view.cell.set', @, (cell) => @setTree(cell._tree) )
+
 		@draw()
 
 	# Resizes the cell to the window size
@@ -67,3 +69,11 @@ class View.Main extends View.RaphaelBase
 		super()
 		@_paper.remove()
 		$( window ).unbind()
+	
+	# Sets the tree of the view
+	#
+	# @param tree [Model.UndoTree] The tree
+	#
+	setTree:( tree ) ->
+		@_tree = tree
+		@draw()
-- 
1.8.0.msysgit.0

